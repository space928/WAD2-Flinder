{% extends 'flinder/base.html' %}
{% load staticfiles %}

{% block title_block %}
    Home
{% endblock %}

{% block nav_block %}
    <a class="btn-outline-secondary btn px-3 py-2 me-2 ms-auto" href="{% url "flinder:edit_profile" %}">
        <i class="fa-solid fa-user"></i>
    </a>
{% endblock %}

<!-- This is used to center the content vertically -->
{% block main_class %} my-auto {% endblock %}

{% block body_block %}
    <div class="container-fluid row">
        <div class="col-md">
            <h1 class="my-3">
                Your Matches
            </h1>
            <div id="matches-container" class="container">
            
            </div>
        </div>
        <div class="col-md">
            <div class="swiper d-flex align-content-center justify-content-center" id="swiper">

            </div>
        </div>
    </div>
{% endblock %}

{% block script_block %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="/static/js/swiper.js"></script>
    <script>
        const apiURLCards = "{% url 'flinder:get_cards' %}"

        const swiperContainer = document.getElementById('swiper');
        const swiper = new Swiper(swiperContainer, 100, 0.25, 45, 0.05);
        swiper.onHeld = (card) => {
            card.classList.add("swiper-card-held");
        };
        swiper.onRelease = (card) => {
            card.classList.remove("swiper-card-held");
        };

        loadMoreCards = ()=>{
            return fetch(apiURLCards).then((d)=>{
                return d.json().then((data)=>{
                    createCards(data);
                });
        })};

        createCards = (newCards)=>{
            for(let card of newCards) {
                const container = document.createElement("div");
                const textContainer = document.createElement("div");
                const title = document.createElement("h3");
                const subtitle = document.createElement("p");

                container.appendChild(textContainer);
                textContainer.appendChild(title);
                textContainer.appendChild(subtitle);

                container.className = "align-items-end d-flex my-2 rounded-3 swiper-card";
                textContainer.className = "col ms-4";
                title.className = "row";
                subtitle.className = "row";

                title.innerHTML = card.name;
                subtitle.innerHTML = card.subtitle;
                container.style.backgroundImage = `url(${card.photo})`;

                swiperContainer.appendChild(container);
            }
        };

        loadMoreCards().then(()=>{
            swiper.updateCards();
        });
    </script>
    <script>
        const apiURLMatches = "{% url 'flinder:get_matches' %}";
        let matches = [];
        loadMoreMatches = ()=>{
            return fetch(apiURLMatches).then((d)=>{
                return d.json().then((data)=>{
                    matches.push(...data);
                });
        })};

        appendMatchesToDom = ()=>{
            const matchesRoot = document.getElementById("matches-container");
            for(let i = 0; i < matches.length; i++){
                const container = document.createElement("div");
                const textContainer = document.createElement("div");
                const imageContainer = document.createElement("div");
                const title = document.createElement("h3");
                const subtitle = document.createElement("p");
                const image = document.createElement("img");
                const link = document.createElement("a");

                container.appendChild(imageContainer);
                container.appendChild(textContainer);
                imageContainer.appendChild(image);
                textContainer.appendChild(title);
                textContainer.appendChild(subtitle);
                textContainer.appendChild(link);

                title.innerHTML = matches[i].name;
                subtitle.innerHTML = matches[i].subtitle;
                image.src = matches[i].photo;
                link.href = matches[i].url;

                container.className = "row align-items-center position-relative my-2";
                textContainer.className = "col";
                imageContainer.className = "image-thumbnail p-0 mx-3";
                image.className = "rounded-circle";
                title.className = "row";
                subtitle.className = "row";
                link.className = "stretched-link";

                matchesRoot.appendChild(container);
            }
        }

        loadMoreMatches().then(appendMatchesToDom);
    </script>
{% endblock %}
